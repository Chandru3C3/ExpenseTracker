<div class="card">
  <h2>Expense Management</h2>
  
  <p-toast></p-toast>
  <p-confirmDialog></p-confirmDialog>
  
  <div class="mb-3">
    <p-button 
      label="Add Expense" 
      icon="pi pi-plus" 
      (onClick)="showDialogToAdd()">
    </p-button>
  </div>
  
  <p-table 
    [value]="expenses" 
    [tableStyle]="{'min-width': '60rem'}"
    [paginator]="true"
    [rows]="10">
    <ng-template pTemplate="header">
      <tr>
        <th>Date</th>
        <th>Category</th>
        <th>Description</th>
        <th>Amount</th>
        <th>Payment Method</th>
        <th>Actions</th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-expense>
      <tr>
        <td>{{ expense.expenseDate | date }}</td>
        <td>{{ expense.category }}</td>
        <td>{{ expense.description }}</td>
        <td>{{ expense.amount | currency:'INR' }}</td>
        <td>{{ expense.paymentMethod }}</td>
        <td>
          <p-button 
            icon="pi pi-pencil" 
            styleClass="p-button-rounded p-button-success mr-2"
            (onClick)="editExpense(expense)">
          </p-button>
          <p-button 
            icon="pi pi-trash" 
            styleClass="p-button-rounded p-button-danger"
            (onClick)="deleteExpense(expense)">
          </p-button>
        </td>
      </tr>
    </ng-template>
  </p-table>
</div>

<p-dialog 
  [(visible)]="displayDialog" 
  [header]="isEdit ? 'Edit Expense' : 'Add Expense'"
  [modal]="true"
  [style]="{width: '450px'}">
  
  <div class="p-fluid">
    <div class="field">
      <label for="category">Category</label>
      <p-dropdown 
        id="category"
        [(ngModel)]="expense.category"
        [options]="categories"
        optionLabel="label"
        optionValue="value"
        placeholder="Select a category">
      </p-dropdown>
    </div>
    
    <div class="field">
      <label for="description">Description</label>
      <input 
        type="text" 
        pInputText 
        id="description"
        [(ngModel)]="expense.description"
        required>
    </div>
    
    <div class="field">
      <label for="amount">Amount</label>
      <p-inputNumber 
        id="amount"
        [(ngModel)]="expense.amount"
        mode="currency"
        currency="INR"
        locale="en-IN">
      </p-inputNumber>
    </div>
    
    <div class="field">
      <label for="expenseDate">Date</label>
      <input 
        type="date" 
        pInputText 
        id="expenseDate"
        [(ngModel)]="expense.expenseDate">
    </div>
    
    <div class="field">
      <label for="paymentMethod">Payment Method</label>
      <p-dropdown 
        id="paymentMethod"
        [(ngModel)]="expense.paymentMethod"
        [options]="paymentMethods"
        optionLabel="label"
        optionValue="value"
        placeholder="Select payment method">
      </p-dropdown>
    </div>
  </div>
  
  <ng-template pTemplate="footer">
    <p-button 
      label="Cancel" 
      icon="pi pi-times"
      styleClass="p-button-text"
      (onClick)="displayDialog = false">
    </p-button>
    <p-button 
      label="Save" 
      icon="pi pi-check"
      (onClick)="saveExpense()">
    </p-button>
  </ng-template>
</p-dialog>
